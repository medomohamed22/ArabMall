<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donate Way - Pi Network</title>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Segoe UI',Tahoma;
    background:linear-gradient(135deg,#f5f0ff,#e6d9ff);
    color:#4a148c
}
.container{max-width:1100px;margin:auto;padding:15px}
.header{text-align:center;position:relative;margin-bottom:35px}
#lang-switch{
    position:absolute;top:10px;right:10px;
    background:#7e57c2;color:#fff;border:none;
    padding:8px 16px;border-radius:50px;cursor:pointer
}
.logo{font-size:80px;color:#7e57c2}
h1{margin:5px 0;color:#6a1b9a}
.intro{font-size:17px}
#user{font-size:20px;font-weight:bold;margin-top:10px}

.campaigns{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:20px
}
.card{
    background:#fff;
    padding:20px;
    border-radius:22px;
    box-shadow:0 10px 30px rgba(126,87,194,.2);
    text-align:center
}
.icon{font-size:50px}
.amounts{
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:8px;
    margin:15px 0
}
.amount-btn{
    background:#ede7f6;
    border:2px solid #b39ddb;
    border-radius:50px;
    padding:8px 14px;
    cursor:pointer
}
.amount-btn.selected{
    background:#7e57c2;
    color:#fff
}
.custom-input{
    width:140px;
    padding:8px;
    border-radius:50px;
    border:2px solid #b39ddb;
    text-align:center
}
.donate{
    width:100%;
    background:linear-gradient(135deg,#9c27b0,#7e57c2);
    color:#fff;
    border:none;
    padding:14px;
    border-radius:50px;
    font-size:17px;
    margin-top:12px;
    cursor:pointer
}

/* Dashboard */
.dashboard{
    margin-top:60px;
    background:#fff;
    padding:20px;
    border-radius:22px;
    box-shadow:0 15px 35px rgba(126,87,194,.25)
}
.dashboard h2{text-align:center;color:#6a1b9a}
.table-wrap{overflow-x:auto}
table{
    width:100%;
    border-collapse:collapse;
    min-width:650px
}
thead{background:#7e57c2;color:#fff}
th,td{
    padding:10px;
    text-align:center;
    font-size:14px
}
tbody tr:nth-child(even){background:#f3e5f5}
.badge{
    padding:5px 14px;
    border-radius:50px;
    font-size:12px
}
.user{background:#d1c4e9}
.guest{background:#ffe0b2;color:#e65100}

footer{text-align:center;margin:40px 0;color:#7b1fa2;font-size:14px}

@media(max-width:480px){
    .logo{font-size:65px}
    h1{font-size:28px}
    .intro{font-size:15px}
}
</style>
</head>

<body>
<div class="container">

<div class="header">
    <button id="lang-switch">AR</button>
    <div class="logo">Ï€</div>
    <h1>Donate Way</h1>
    <p class="intro"></p>
    <div id="user"></div>
</div>

<div id="campaigns" class="campaigns"></div>

<div class="dashboard">
<h2>Donations Dashboard</h2>
<div class="table-wrap">
<table>
<thead>
<tr>
<th>#</th>
<th>Donor</th>
<th>Campaign</th>
<th>Amount</th>
<th>TXID</th>
<th>Date</th>
</tr>
</thead>
<tbody id="donations"></tbody>
</table>
</div>
</div>

<footer>Donate Way Â© 2025</footer>

</div>

<script>
Pi.init({version:"2.0"});

let currentLang="en";
let currentUser=null;
let selected={};

const text={
en:{
intro:"Donate with Pi Network to support humanitarian campaigns",
guest:"Donate as Guest",
hello:"Welcome, {name}",
donate:"Donate {amount} Pi",
campaigns:[
{t:"Food Aid",d:"Help families with food",i:"ðŸ²"},
{t:"Education",d:"Support children education",i:"ðŸ“š"},
{t:"Medical",d:"Medical support",i:"ðŸ¥"},
{t:"Water",d:"Clean water projects",i:"ðŸ’§"}
]
},
ar:{
intro:"ØªØ¨Ø±Ø¹ Ø¨Ø¹Ù…Ù„Ø© Pi Ù„Ø¯Ø¹Ù… Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ©",
guest:"ØªØ¨Ø±Ø¹ ÙƒØ²Ø§Ø¦Ø±",
hello:"Ù…Ø±Ø­Ø¨Ø§Ù‹ {name}",
donate:"ØªØ¨Ø±Ø¹ {amount} Pi",
campaigns:[
{t:"Ù…Ø³Ø§Ø¹Ø¯Ø© ØºØ°Ø§Ø¦ÙŠØ©",d:"ØªÙˆÙÙŠØ± Ø·Ø¹Ø§Ù… Ù„Ù„Ø£Ø³Ø±",i:"ðŸ²"},
{t:"Ø§Ù„ØªØ¹Ù„ÙŠÙ…",d:"Ø¯Ø¹Ù… ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø·ÙØ§Ù„",i:"ðŸ“š"},
{t:"Ø§Ù„Ø¹Ù„Ø§Ø¬",d:"Ù…Ø³Ø§Ø¹Ø¯Ø© Ø·Ø¨ÙŠØ©",i:"ðŸ¥"},
{t:"Ø§Ù„Ù…ÙŠØ§Ù‡",d:"Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙŠØ§Ù‡ Ù†Ø¸ÙŠÙØ©",i:"ðŸ’§"}
]
}
};

function updateUser(){
    document.getElementById("user").textContent =
        currentUser
        ? text[currentLang].hello.replace("{name}", currentUser)
        : text[currentLang].guest;
}

/* âœ… Ø§Ù„Ø­Ù„ Ù‡Ù†Ø§ */
function authAuto(){
    const saved = localStorage.getItem("pi_username");
    if(saved){
        currentUser = saved;
    }
    updateUser();
}

function renderCampaigns(){
    const wrap=document.getElementById("campaigns");
    wrap.innerHTML="";
    text[currentLang].campaigns.forEach((c,i)=>{
        selected[i]=10;
        wrap.innerHTML+=`
        <div class="card">
            <div class="icon">${c.i}</div>
            <h3>${c.t}</h3>
            <p>${c.d}</p>
            <div class="amounts">
                <button class="amount-btn selected" data-i="${i}" data-a="5">5</button>
                <button class="amount-btn" data-i="${i}" data-a="10">10</button>
                <button class="amount-btn" data-i="${i}" data-a="50">50</button>
            </div>
            <input class="custom-input" placeholder="Custom">
            <button class="donate" data-i="${i}">
                ${text[currentLang].donate.replace("{amount}",10)}
            </button>
        </div>`;
    });

    document.querySelectorAll(".amount-btn").forEach(b=>{
        b.onclick=()=>{
            const i=b.dataset.i;
            document.querySelectorAll(`[data-i="${i}"].amount-btn`)
                .forEach(x=>x.classList.remove("selected"));
            b.classList.add("selected");
            selected[i]=b.dataset.a;
            document.querySelector(`.donate[data-i="${i}"]`).textContent =
                text[currentLang].donate.replace("{amount}",selected[i]);
        };
    });

    document.querySelectorAll(".donate").forEach(btn=>{
        btn.onclick=()=>pay(btn.dataset.i);
    });
}

function saveDonation(d){
    const arr=JSON.parse(localStorage.getItem("donations")||"[]");
    arr.unshift({...d,date:new Date().toLocaleString()});
    localStorage.setItem("donations",JSON.stringify(arr));
    renderDashboard();
}

function renderDashboard(){
    const body=document.getElementById("donations");
    const arr=JSON.parse(localStorage.getItem("donations")||"[]");
    body.innerHTML="";
    arr.forEach((d,i)=>{
        body.innerHTML+=`
        <tr>
            <td>${i+1}</td>
            <td><span class="badge ${d.donor==="Guest"?"guest":"user"}">${d.donor}</span></td>
            <td>${d.campaign}</td>
            <td>${d.amount}</td>
            <td>${d.txid}</td>
            <td>${d.date}</td>
        </tr>`;
    });
}

async function pay(i){
    try{
        const scopes = currentUser ? ["payments"] : ["username","payments"];
        const user = await Pi.authenticate(scopes);

        if(user.username){
            currentUser = user.username;
            localStorage.setItem("pi_username", currentUser);
        }
        updateUser();

        Pi.createPayment({
            amount:Number(selected[i]),
            memo:text[currentLang].campaigns[i].t,
            metadata:{
                campaign:text[currentLang].campaigns[i].t,
                donor:currentUser || "Guest"
            }
        },{
            onReadyForServerApproval:(paymentId)=>{
                fetch("/api/pi/approve",{
                    method:"POST",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({paymentId})
                });
            },
            onReadyForServerCompletion:(paymentId,txid)=>{
                fetch("/api/pi/complete",{
                    method:"POST",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({paymentId,txid})
                });
                saveDonation({
                    donor:currentUser||"Guest",
                    campaign:text[currentLang].campaigns[i].t,
                    amount:selected[i],
                    txid
                });
                alert("Payment Success âœ…");
            },
            onCancel:()=>alert("Cancelled"),
            onError:(e)=>alert(e.message)
        });

    }catch(e){
        alert(e.message);
    }
}

document.getElementById("lang-switch").onclick=()=>{
    currentLang=currentLang==="en"?"ar":"en";
    document.documentElement.dir=currentLang==="ar"?"rtl":"ltr";
    document.querySelector(".intro").textContent=text[currentLang].intro;
    renderCampaigns();
    updateUser();
};

document.querySelector(".intro").textContent=text[currentLang].intro;
authAuto();
renderCampaigns();
renderDashboard();
</script>

</body>
</html>
