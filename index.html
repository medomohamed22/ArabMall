<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Way - تبرع لسبب وجيه</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        :root {
            --purple-main: #6a1b9a;
            --purple-light: #9c4dcc;
            --white-main: #ffffff;
            --gray-light: #f5f5f5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--white-main);
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

       .container {
            width: 90%;
            max-width: 600px;
            background: var(--gray-light);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            color: var(--purple-main);
            text-align: center;
            font-size: 2.5em;
        }

       .cta-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background-color: var(--purple-main);
            color: var(--white-main);
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

       .cta-button:hover {
            background-color: var(--purple-light);
        }

        /* */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>طريق العطاء</h1>
            <p style="text-align: center;">شارك في العطاء باستخدام عملة Pi Network.</p>
        </header>

        <section class="donation-form">
            <h2>دعمك يصنع فرقاً</h2>
            <form id="donationForm">
                <div class="input-group">
                    <label for="amount">مبلغ التبرع (Pi)</label>
                    <input type="number" id="amount" name="amount" placeholder="أدخل مبلغ التبرع" required>
                </div>
                <div class="input-group">
                    <label for="memo">رسالة تبرع</label>
                    <textarea id="memo" name="memo" placeholder="اكتب رسالتك (اختياري)"></textarea>
                </div>
                <button type="submit" class="cta-button">تبرع الآن بـ Pi</button>
            </form>
        </section>

        <footer>
            <p style="text-align: center; color: #777;">&copy; 2025 طريق العطاء. جميع الحقوق محفوظة.</p>
        </footer>
    </div>

    <script>
        // تحذير: هذا الكود غير مكتمل وغير آمن للتعامل مع المدفوعات الحقيقية
        // يجب إرسال البيانات إلى خادم خلفي موثوق به لإكمال المعاملات بشكل آمن.

        const amountInput = document.getElementById('amount');
        const memoInput = document.getElementById('memo');
        const donationForm = document.getElementById('donationForm');

        // تهيئة Pi SDK
        Pi.init({ version: "2.0" });

        donationForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // الخطوة 1: مصادقة المستخدم
            try {
                // طلب الصلاحيات اللازمة (الدفعات واسم المستخدم)
                const scopes = ['payments', 'username']; 
                const authResult = await Pi.authenticate(scopes);
                console.log('Authentication successful:', authResult);
                
                const accessToken = authResult.accessToken;
                
                // *** تحذير أمني: لا تستخدم accessToken مباشرة على الواجهة الأمامية!
                // يجب إرسالها إلى خادم خلفي للتحقق منها عبر نقطة النهاية /me.[span_42](start_span)[span_42](end_span)
                // الخطوة التالية هنا مجرد توضيح للمنطق المطلوب، ولكن يجب تنفيذها على الخادم.

                // الخطوة 2: إنشاء الدفع
                const paymentData = {
                    amount: Number(amountInput.value),
                    memo: memoInput.value,
                    metadata: {}
                };

                const paymentCallbacks = {
                    onReadyForServerApproval: function(paymentId) {
                        // *** هذه الوظيفة يجب أن ترسل paymentId إلى الخادم الخلفي
                        // الخادم الخلفي يجب أن يقوم بالاتصال بنقطة النهاية /approve في Pi API.[span_50](start_span)[span_50](end_span)
                        console.log('Payment ready for server approval. ID:', paymentId);
                        // simulate backend call for approval
                        simulateServerApproval(paymentId);
                    },
                    onReadyForServerCompletion: function(paymentId, txid) {
                        // *** هذه الوظيفة يجب أن ترسل paymentId و txid إلى الخادم الخلفي
                        // الخادم الخلفي يجب أن يقوم بالاتصال بنقطة النهاية /complete في Pi API.[span_51](start_span)[span_51](end_span)
                        console.log('Payment ready for server completion. ID:', paymentId, 'TxID:', txid);
                        // simulate backend call for completion
                        simulateServerCompletion(paymentId, txid);
                    },
                    onCancel: function(paymentId) {
                        console.log('Payment canceled. ID:', paymentId);
                    },
                    onError: function(error, payment) {
                        console.error('Payment error:', error);
                    }
                };

                Pi.payments.createPayment(paymentData, paymentCallbacks);

            } catch (error) {
                console.error('An error occurred:', error);
            }
        });
        
        // وظائف وهمية لمحاكاة الاتصال بالخادم الخلفي
        function simulateServerApproval(paymentId) {
            console.log('Simulating server approval for payment ID:', paymentId);
            // In a real app, this would be an AJAX call to the backend.
        }

        function simulateServerCompletion(paymentId, txid) {
            console.log('Simulating server completion for payment ID:', paymentId, 'with TxID:', txid);
            // In a real app, this would be an AJAX call to the backend.
        }
    </script>
</body>
</html>
