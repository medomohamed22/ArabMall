<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donate Way</title>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<style>
:root{
  --primary:#7e57c2;
  --secondary:#ede7f6;
  --bg:#f7f5fb;
  --card:#ffffff;
  --text:#2c2c2c;
  --success:#4caf50;
  --error:#f44336;
  --info:#2196f3;
}
body.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#f1f1f1;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}
header{
  padding:20px;
  text-align:center;
}
header h1{
  margin:0;
  color:var(--primary);
}
.toggle{
  position:absolute;
  top:20px;
  right:20px;
  cursor:pointer;
  font-size:20px;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:15px;
}
.user-box{
  text-align:center;
  margin-bottom:20px;
  font-weight:bold;
}
.campaigns{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
}
.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  display:flex;
  flex-direction:column;
}
.icon{
  font-size:48px;
  text-align:center;
}
.card h3{
  margin:10px 0 5px;
  text-align:center;
}
.card p{
  font-size:14px;
  text-align:center;
  opacity:.85;
}
.progress{
  background:#ddd;
  border-radius:20px;
  height:10px;
  overflow:hidden;
  margin:10px 0;
}
.progress span{
  display:block;
  height:100%;
  background:var(--primary);
}
input,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  font-size:16px;
  margin-top:10px;
}
input{
  border:1px solid #ccc;
  background:transparent;
  color:var(--text);
}
button{
  background:linear-gradient(135deg,#9c27b0,#7e57c2);
  border:none;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
button:hover{opacity:.9}
footer{
  text-align:center;
  margin:40px 0 10px;
  font-size:13px;
  opacity:.7;
}

/* Toast Messages */
#toast{
  position:fixed;
  top:20px;
  right:20px;
  z-index:9999;
  min-width:250px;
  padding:15px 20px;
  border-radius:12px;
  color:white;
  font-weight:bold;
  display:none;
  box-shadow:0 8px 20px rgba(0,0,0,.2);
  animation:fadein 0.5s, fadeout 0.5s 2.5s;
}
#toast.success{background:var(--success);}
#toast.error{background:var(--error);}
#toast.info{background:var(--info);}
@keyframes fadein{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeout{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-20px)}}

/* Mobile */
@media(max-width:600px){
  header h1{font-size:24px}
}
</style>
</head>

<body>
<header>
  <h1>Donate Way ðŸ’œ</h1>
  <div class="toggle" onclick="toggleMode()">ðŸŒ“</div>
</header>

<div class="container">

<div class="user-box">
  ðŸ‘¤ <span id="user">Guest</span>
</div>

<div class="campaigns" id="campaigns"></div>

<footer>
Donate Way Â© 2025 â€“ Powered by Pi Network
</footer>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
Pi.init({ version:"2.0", sandbox:false });

let currentUser = "Guest";

// Toast function
function showToast(msg,type="info"){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.className=type;
  t.style.display="block";
  setTimeout(()=>{t.style.display="none"},3000);
}

// Attempt to detect Pi username automatically
async function detectUser(){
  try{
    const user = await Pi.authenticate(['username']); 
    if(user.username){
      currentUser=user.username;
      localStorage.setItem("pi_user",currentUser);
      document.getElementById("user").innerText=currentUser;
      showToast(`Welcome, ${currentUser} ðŸ‘‹`,"success");
    }
  }catch(e){
    console.log("Guest mode");
    currentUser = localStorage.getItem("pi_user") || "Guest";
    document.getElementById("user").innerText=currentUser;
  }
}

// Campaigns array
const campaigns = [
  { title:"Food Aid", desc:"Provide meals for families in need.", icon:"ðŸ²", progress:65 },
  { title:"Education Support", desc:"Support education for children.", icon:"ðŸ“š", progress:40 },
  { title:"Medical Treatment", desc:"Help patients afford treatment.", icon:"ðŸ¥", progress:80 },
  { title:"Clean Water", desc:"Build wells and water projects.", icon:"ðŸ’§", progress:55 }
];

function toggleMode(){document.body.classList.toggle("dark");}

// Render campaigns
function renderCampaigns(){
  const box = document.getElementById("campaigns");
  box.innerHTML="";
  campaigns.forEach((c,i)=>{
    box.innerHTML += `
      <div class="card">
        <div class="icon">${c.icon}</div>
        <h3>${c.title}</h3>
        <p>${c.desc}</p>
        <div class="progress"><span style="width:${c.progress}%"></span></div>
        <input type="number" min="0.01" step="0.01" placeholder="Donation amount (Pi)" id="amount-${i}">
        <button onclick="donate(${i})">Donate with Pi</button>
      </div>
    `;
  });
}

// Donate function
async function donate(index){
  const amountInput=document.getElementById(`amount-${index}`);
  const amount=Number(amountInput.value);
  if(!amount||amount<=0){showToast("Enter valid amount","error");return;}

  try{
    const auth = await Pi.authenticate(['username','payments']);
    if(auth.username){
      currentUser=auth.username;
      localStorage.setItem("pi_user",currentUser);
      document.getElementById("user").innerText=currentUser;
    }
  }catch(e){
    console.log("Guest mode");
  }

  Pi.createPayment({
    amount,
    memo:`${campaigns[index].title} donation`,
    metadata:{campaign:campaigns[index].title,donor:currentUser}
  },{
    onReadyForServerApproval: async(paymentId)=>{
      await fetch("/api/pi/approve",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({paymentId})});
    },
    onReadyForServerCompletion: async(paymentId,txid)=>{
      await fetch("/api/pi/complete",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({paymentId,txid})});
      showToast("Donation successful âœ…","success");
      amountInput.value="";
    },
    onCancel:()=>showToast("Payment cancelled","info"),
    onError:e=>showToast(e.message,"error")
  });
}

// Initialize
detectUser();
renderCampaigns();
</script>
</body>
</html>
