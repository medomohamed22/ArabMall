<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مدفوعات Pi Network</title>
  <script>
    // مفتاح API الخاص بـ Pi Network
    const API_KEY = "wbegvil1tpnoi8o2tkieob8e5c1aluxmsit83kh6wyocipcmsw283j7fhfwebjuv";

    async function createPayment(productId, amount, memo) {
      try {
        // إرسال طلب إلى Pi Network لإنشاء دفعة
        const response = await fetch("https://api.minepi.com/v2/payments", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Key ${API_KEY}`,
          },
          body: JSON.stringify({
            amount: amount,
            memo: memo,
            metadata: { productId: productId },
          }),
        });

        if (response.ok) {
          const data = await response.json();
          return data.paymentId; // معرف الدفع المُنشأ
        } else {
          const errorData = await response.json();
          console.error("Error creating payment:", errorData);
          alert("فشل إنشاء الدفع، تحقق من البيانات.");
          return null;
        }
      } catch (error) {
        console.error("Error:", error);
        alert("خطأ أثناء إنشاء الدفع.");
        return null;
      }
    }

    async function approvePayment(paymentId) {
      try {
        // إرسال طلب الموافقة على الدفع
        const response = await fetch(`https://api.minepi.com/v2/payments/${paymentId}/approve`, {
          method: "POST",
          headers: {
            Authorization: `Key ${API_KEY}`,
          },
        });

        if (response.ok) {
          alert(`تمت الموافقة على الدفع: ${paymentId}`);
        } else {
          const errorData = await response.json();
          console.error("Error approving payment:", errorData);
          alert("فشل الموافقة على الدفع.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("حدث خطأ أثناء الموافقة على الدفع.");
      }
    }

    async function handlePayment() {
      const productId = "12345"; // معرف المنتج
      const amount = 10; // المبلغ بالدولار
      const memo = "Purchase Item"; // وصف الدفعة

      // إنشاء الدفع
      const paymentId = await createPayment(productId, amount, memo);

      if (paymentId) {
        // الموافقة على الدفع إذا تم إنشاؤه بنجاح
        await approvePayment(paymentId);
      }
    }
  </script>
</head>
<body>
  <h1>نظام مدفوعات Pi Network</h1>
  <p>اضغط على الزر أدناه للبدء في الدفع باستخدام Pi Network:</p>
  <button onclick="handlePayment()">ادفع الآن</button>
</body>
</html>
