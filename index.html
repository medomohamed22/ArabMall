<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مدفوعات Pi Network</title>
  <script>
    async function initiatePayment() {
      const paymentData = {
        productId: "12345", // معرف المنتج
        amount: 10, // المبلغ بالدولار
        memo: "Purchase Item",
      };

      try {
        // إرسال طلب لإنشاء دفعة
        const createResponse = await fetch("http://localhost:8000/payments/create", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include", // للسماح باستخدام الكوكيز
          body: JSON.stringify(paymentData),
        });

        const createResult = await createResponse.json();
        if (createResponse.ok) {
          const paymentId = createResult.paymentId; // استرجاع معرف الدفع

          // تأكيد الدفع
          const approveResponse = await fetch("http://localhost:8000/payments/approve", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
            body: JSON.stringify({ paymentId }),
          });

          const approveResult = await approveResponse.json();
          if (approveResponse.ok) {
            alert(`تمت الموافقة على الدفع: ${approveResult.message}`);
          } else {
            alert(`خطأ: ${approveResult.message}`);
          }
        } else {
          alert(`خطأ في إنشاء الدفع: ${createResult.message}`);
        }
      } catch (error) {
        console.error("حدث خطأ أثناء معالجة الدفع:", error);
        alert("حدث خطأ أثناء الدفع. يُرجى المحاولة لاحقًا.");
      }
    }
  </script>
</head>
<body>
  <h1>مدفوعات Pi Network</h1>
  <p>اضغط على الزر أدناه للبدء في الدفع باستخدام Pi Network:</p>
  <button onclick="initiatePayment()">ادفع الآن</button>
</body>
</html>
